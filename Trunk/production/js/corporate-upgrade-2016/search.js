/*! ICAEW corporate-upgrade-2016 2016-08-25 */
define("corporate-upgrade-2016/search",["jquery","handlebars","corporate-upgrade-2016/searchRefinements","corporate-upgrade-2016/searchSuggestions","corporate-upgrade-2016/searchPreviews","corporate-upgrade-2016/paging"],function(a,b,c,d,e){"use strict";return{initialize:function(){a(function(){function f(d,e,f){var g=a("#search-results #result-container");c.update(d.Refinements,f);var h=f?d.Result.PageSize:parseInt(a(".showing").html())+d.Result.PageSize;h>d.Result.TotalResults&&(h=d.Result.TotalResults);var i=a("#keyword").val();if(dataLayer=window.dataLayer||[],dataLayer.push({searchResultCountTotal:d.Result.TotalResults,keyword:i}),a(".showing").html(h),a(".total").html(d.Result.TotalResults),a(".querytext").text(i),""!=i&&a(".cta-link.term").html("<strong>Search:</strong> "+a("<div/>").text(i).html()+"<span></span>").attr("title","Remove "+i).parent().show(),a(".collection").text(a("#search-collection option:selected").text()),a(".responsetime").text(d.ResponseTime.toFixed(3)),d.SpellingSuggestion&&"acca exam"==d.SpellingSuggestion.Query.toLowerCase().trim().slice(0,9)&&(d.SpellingSuggestion=null),0!=d.Result.TotalResults){if(a("#no-result-container").hide(),a("#search-results #result-container").show(),f){var j=a("#search-template").html(),k=b.compile(j),l=k(d);g.append(l)}var m=a("#search-result-template").html(),n=b.compile(m),o=n(d);a("#search-results #result-container .content-list.component").append(o),a(".ajax-reveal").hide().slideDown(400,function(){setTimeout(function(){a(".ajax-reveal article").unwrap()},2e3)})}else a("#no-result-container").show(),a("#search-results #result-container").hide();h<d.Result.TotalResults?a(".view-more-section").show():a(".view-more-section").hide()}function g(a){a.search(!0)}var h={callback:f,rootPath:"/api/corporate-upgrade-2016/search/getsearchresult",begin:function(b){b&&a("#search-results #result-container").empty(),a("#ajax-loader").show()},always:function(){a("#ajax-loader").hide()},fail:function(){},valuesSelector:"#search-refinements, #keyword, #search-collection",autoNextPage:!1,minMs:1e3};a(".pagination-centered").hide();var i=a(".more-link .page").page(h);a("#search-refinements").change(function(){g(i)}),a("#search-collection").change(function(){c.reset(!1),g(i)}),a("#search-submit-button").click(function(a){a.preventDefault(),g(i)}),a("#search-selection .cta-link.term").click(function(b){b.preventDefault(),a(this).parent().hide(),a("#keyword").val(""),g(i)}),a("#search-selection .reset").click(function(b){b.preventDefault(),a("#search-selection .cta-link.term").parent().hide(),a("#keyword").val(""),c.reset(!1),g(i)}),a("#search-form").submit(function(a){a.preventDefault(),g(i)}),a("#keyword").data("timeout",null).keyup(function(b){if(d.keydown(b),40!=event.keyCode&&38!=event.keyCode){if(13==event.keyCode)return a("#search-form").trigger("submit"),void 0;clearTimeout(jQuery(this).data("timeout")),jQuery(this).data("timeout",setTimeout(function(){a("#search-form").trigger("submit")},300))}}),c.initialize(),e.initialize(),d.initialize()})}}}),define("corporate-upgrade-2016/searchPreviews",["jquery"],function(a){"use strict";return{initialize:function(){var b=this;a("#result-container").delegate("h1:has(.preview)","mouseover mouseout",function(){var c=a(this).find(".preview");if("mouseover"==event.type){var d=setTimeout(function(){b.open(c)},500);c.data("timeout",d)}else clearTimeout(c.data("timeout")),a("#result-container .preview.showing").not(c).removeClass("showing")}),a("#result-container").delegate(".preview .controls .prev","click",function(){b.goTo(a(this),"prev")}),a("#result-container").delegate(".preview .controls .next","click",function(){b.goTo(a(this),"next")}),a("#result-container").delegate(".preview .controls .exit","click",function(){b.close(a(this).closest(".preview"))})},goTo:function(a,b){var c,d=a.closest(".preview"),e=d.find(".viewport-wrap .pages"),f=parseInt(d.find(".controls .counter span:first").html()),g=parseInt(d.find(".controls .counter span:last").html());if("prev"==b){if(c=f-1,0>=c)return}else if(c=f+1,c>g)return;d.find(".controls .counter span:first").html(c),c-=1,e.animate({left:"-"+100*c+"%"},300)},open:function(b){var c=b.closest("h1"),d=b.find(".page");b.find(".pages img[data-src][src='']").each(function(){a(this).attr("src",a(this).data("src"))}),b.addClass("showing"),b.css({top:(d.height()-c.height())/2*-1})},close:function(a){a.removeClass("showing")}}}),define("corporate-upgrade-2016/searchRefinements",["jquery"],function(a){"use strict";return{selected:[],initialize:function(){var b=this;this.$searchResults=a("#search-results"),a("#search-refine").length&&a("#viewport-wrap .overlay").css("height",a("main").css("height")),a("#search-refine").click(function(c){c.preventDefault(),c.stopPropagation(),a("#viewport-wrap .expand-wrap").hasClass("level-0")?b.close():b.open()}),a("#viewport-wrap main, #viewport-wrap span.confirm").click(function(){b.close()}),a("#viewport-wrap span.close").click(function(a){a.preventDefault(),b.reset()}),a("section.overlay").delegate("ul li input","change",function(){var c=a("section.overlay.level-0 span.active").parent().data("refinements");a(this).is(":checked")?b.select(c.dn,c.mn,a(this).val()):b.unselect(c.mn,a(this).val())}).delegate("ul li > span","click",function(c){c.preventDefault();var d=a(this).parent(),e=a(this).closest("section").data("level"),f=d.data("refinements");if(a(this).hasClass("active"))return b.closeLevel(e),a(this).removeClass("active").parent().removeClass("section"),void 0;var g=a(this).closest("ul");g.find("li span").removeClass("active"),g.find("li.section").each(function(){if(0==e)0==b.hasSelected(a(this).data("metatag"),null,!0)&&a(this).removeClass("section");else{var c=a("section.level-0 ul li span.active").parent().data("metatag");0==b.hasSelected(c,a(this).data("refinements"),!1)&&a(this).removeClass("section")}}),a(this).addClass("active").parent().addClass("section");for(var h=e+1,i="",j=h;4>=j;j++)i+="level-"+j+" ";var k=a("#viewport-wrap .expand-wrap").hasClass("level-"+h);a("#viewport-wrap .expand-wrap").removeClass(i),k?setTimeout(function(){b.updateAndopenLevel(h,f,!0)},600):b.updateAndopenLevel(h,f,!0)}),a("#search-selection").delegate("a.refinement","click",function(c){c.preventDefault(),b.unselect(a(this).data("metatag"),a(this).data("value"))})},update:function(b,c){function d(a,b){for(var c=0;c<a.length;c++)b[a[c].v]=a[c].c,a[c].r&&d(a[c].r,b);return b}function e(a,b){for(var c=0;c<b.length;c++){var d=a[b[c].v];b[c].c=d?d:0,b[c].r&&e(a,b[c].r)}}var f=this;if(c)for(var g=a("section.level-0 ul").empty(),h=0;h<b.length;h++){var i=a('<li data-metatag="'+b[h].mn+'"><h2>'+b[h].dn+'</h2><span class="has-level-1"></span></li>');i.data("refinements",b[h]),g.append(i)}else a("section.level-0 ul li").each(function(){for(var c=0;c<b.length;c++)if(b[c].mn==a(this).data("metatag")){var f=a(this).data("refinements"),g=b[c],h=d(g.r,{});e(h,f.r)}}),a("section.overlay").each(function(){var b=a(this).data("level"),c=a("section.level-"+(b-1)+" ul li span.active"),d=c.closest("li");if(d.length){var e=d.data("refinements");f.updateAndopenLevel(b,e,!1)}})},open:function(){var b=this;a("section.overlay.level-0 li span.active").each(function(){a(this).removeClass("active");var c=a(this).closest("li");0==b.hasSelected(c.data("metatag"),null,!0)&&c.removeClass("section")}),a("#viewport-wrap .expand-wrap").addClass("level-0").removeClass("level-1 level-2 level-3 level-4")},updateAndopenLevel:function(b,c,d){var e=a("section.level-"+b);if(d){var f=c.dn?c.dn:c.v;e.find("h1").text(f);for(var g=e.find("ul").empty(),h=a("section.level-0 ul li span.active").parent().data("metatag"),i=this.selected[h],j=0;j<c.r.length;j++){var k=c.r[j],l=this.hasSelected(h,k,0==b),m=-1;i&&(m=i.indexOf(k.v));var n=a('<li><input type="checkbox" '+(-1!=m?'checked="checked" ':"")+'value="'+k.v+'" id="item-'+b+"-"+j+'"><label for="item-'+b+"-"+j+'">'+k.v+" <span>("+k.c+")</span></label></li>");k.r&&(n.append('<span class="has-level-'+(b+1)+'"></span>'),n.data("refinements",k)),l&&n.addClass("section"),g.append(n)}a("#viewport-wrap .expand-wrap").addClass("level-"+b)}else for(var j=0;j<c.r.length;j++)e.find("input[value='"+c.r[j].v+"'] + label > span").text("("+c.r[j].c+")")},closeLevel:function(b){b++;for(var c="",d=b;4>=d;d++)c+="level-"+d+" ";a("#viewport-wrap .expand-wrap").removeClass(c)},hasSelected:function(a,b,c){var d=this.selected[a];if(d){if(c)return!0;if(null!=b&&b.r){for(var e=!1,f=b.r,g=0;g<f.length;g++){if(d.indexOf(f[g].v)>-1)return!0;if(f[g].r&&(e=this.hasSelected(a,f[g].r,c)))return!0}return e}return!1}return!1},close:function(){var b=a("#viewport-wrap .expand-wrap");b.hasClass("level-0")&&b.removeClass("level-0 level-1 level-2 level-3 level-4")},reset:function(b){this.close(),a("#search-selection a.refinement").parent().remove(),this.selected=[],this.updateHiddenField(b)},select:function(b,c,d){void 0===this.selected[c]&&(this.selected[c]=[]),this.selected[c].push(d);var e=a('<li><a href="#" data-metatag="'+c+'" data-value="'+d+'" class="cta-link remove beta over-ride refinement" title="Remove '+d+'"><strong>'+b+":</strong> "+d+"<span></span></a></li>");a("#search-selection a.reset").parent().before(e),this.updateHiddenField()},unselect:function(b,c){if(this.selected[b]){var d=this.selected[b].indexOf(c);if(d>-1&&this.selected[b].splice(d,1),0==this.selected[b].length){var e=this.selected.indexOf(b);e>-1&&this.selected.splice(e,1)}}a("#search-selection a.refinement[data-metatag='"+b+"'][data-value='"+c+"']").parent().remove(),a("section.level-0 ul li[data-metatag='"+b+"'] span").hasClass("active")&&a("section.overlay input[value='"+c+"']").prop("checked",!1),this.updateHiddenField()},updateHiddenField:function(b){var c=[];for(var d in this.selected)this.selected.hasOwnProperty(d)&&c.push(d+":"+this.selected[d].join(","));0!=b&&a("#search-refinements").val(c.join(";")).trigger("change")}}}),define("corporate-upgrade-2016/searchSuggestions",["jquery"],function(a){"use strict";return{initialize:function(){var b=this;b.$searchSuggestions=a("#search-suggestions"),b.$keyword=a("#keyword"),a("#viewport-wrap main").click(function(){b.$searchSuggestions.is(":visible")&&b.hide()}),b.$searchSuggestions.delegate("a","click",function(c){c.preventDefault(),b.$searchSuggestions.find("li.selected").removeClass("selected"),a(this).closest("li").addClass("selected"),b.$keyword.val(a(this).text()),a("#search-form").trigger("submit"),b.hide()})},keydown:function(a){this.$searchSuggestions.is(":visible")?40==a.keyCode?this.down():38==a.keyCode?this.up():13==a.keyCode&&this.hide():(40==a.keyCode||38==a.keyCode)&&this.show(),40!=a.keyCode&&38!=a.keyCode&&13!=a.keyCode&&this.get()},get:function(){var b=this;this.xhr&&4!=this.xhr.readystate&&this.xhr.abort(),this.xhr=a.getJSON("/api/corporate-upgrade-2016/classification/gethints",{text:b.$keyword.val(),query:a(".more-link .page").data("queryid")},function(a){b.update(a)})},down:function(){var a=this.$searchSuggestions.find("li.selected").removeClass("selected").next();0==a.length&&(a=this.$searchSuggestions.find("li:first")),a.addClass("selected"),this.$keyword.val(a.find("a").text())},up:function(){var a=this.$searchSuggestions.find("li.selected").removeClass("selected").prev();0==a.length&&(a=this.$searchSuggestions.find("li:last")),a.addClass("selected"),this.$keyword.val(a.find("a").text())},hide:function(){this.$searchSuggestions.hide()},show:function(){this.$searchSuggestions.find("li").length&&this.$searchSuggestions.show()},update:function(b){if(this.$searchSuggestions.empty(),b.results.length>0){for(var c=0;c<b.results.length;c++){var d=a('<li><a href="#">'+b.results[c].name+"</a></li>");0==c&&(d.addClass("suggested"),d.append("<span>Suggested Search</span>")),this.$searchSuggestions.append(d)}this.show()}else this.hide()}}});